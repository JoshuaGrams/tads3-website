<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:type" content="website">
    <link rel="icon" href="/assets/images/tads-favicon.png" type="image/png">
    <link rel="stylesheet" type="text/css"
                           href="/assets/css/styles.css">
    <title></title>
    <meta property="og:title" content=
    "">
    <meta name="description" content="">
    <meta property="og:description" content="">
</head>
<header id="header"><div class="header-search">
    <form class="header-search-form" action="/search" method="get">
      <input type="text" id="search-box" name="query">
      <input type="submit" value="search">
    </form>
  </div>  </header>
<body>
<main id="content">
<table width="100%" data-border="0" data-cellspacing="0" data-cellpadding="3" data-bgcolor="#C0C0C0">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr>
<td style="text-align: left;"><strong>Candle &amp; FireSource<br />
</strong></td>
<td style="text-align: right;"><a href="flashlight.html">[Previous]</a>
<a href="generalintroduction.html">[Main]</a> <a href="oillamp.html">[Next]</a></td>
</tr>
</tbody>
</table>

<p>Candle is the other specialization of LightSource provided in the
library (strictly speaking, it inherits from FueledLightSource, which in
turn inherits from <a href="lightsource.html">LightSource</a>). It can, of course,
be used to implement candles (as we’ll do in just a minute), but it is
useful for implementing any light source with a limited fuel supply or
burn life (as we shall go on to explore).</p>

<p>We have already defined some candles in our game (back when we
implemented a <a href="dispenser.html">Dispenser</a>). You may recall we in fact
defined our own RedCandle class. As yet, however, we have provided no
means of lighting them. What we need for the task is a FireSource. One
is available in the shape of the flaming torch attached to the wall, but
we need to make some changes to it so it will act as a FireSource.</p>

<p><strong>FireSource, </strong>Fixture ’<strong>flaming torch torch/flame/flames</strong>‘ ’torch’ @mainCave<br />
  ”The torch, which is fixed firmly to wall by a steel bracket, is blazing merrily,<br />
   its flames casting a bright but flickering light over the cave. ”<br />
   cannotTakeMsg = ’It\s fixed to the wall. ’<br />
   **preCondIobjBurnWith = static inherited - objHeld<br />
   isLit = true<br />
   disambigName = ’flaming torch’<br />
**;</p>

<p>There’s a few things to note here. Firstly, the default handling for a
FireSource requires that the actor is holding it before it can be used
to light anything else; this is not appropriate, or not even possible,
for a flaming torch fixed to the wall, so we need to removed the objHeld
precondition. This is what we do with
preCondIobjBurnWith = static inherited - objHeld, which, so far as the
compiler is concerned, is precisely the same as if we had written:</p>

<p>iobjFor(BurnWith)<br />
{<br />
  preCond = static inherited - objHeld<br />
}</p>

<p>Which might have been clearer, but is also a bit more long-winded. This
shorter syntax is worth considering when overriding only a single method
of a dobjFor or iobjFor set, but probably not worth the loss of clarity
if overriding two or more such methods. (To construct the appropriate
method or property name, begin with ‘verify’, ‘check’, ‘action’ or
‘preCond’, then add either ‘Dobj’ or ‘Iobj’ and conclude with the action
specifier, e.g. ‘Take’, ‘Drop’ , or, as here, ‘BurnWith’ ).</p>

<p>We need to set isLit = true, otherwise the FireSource will be regarded
as unlit and thus not capable of lighting anything else (until lit
itself). Finally, we add a disambigName in case there’s ever a name
clash with the torch (flashlight) we defined in the last section.</p>

<p>A further customization that might be worth making is to the vocabulary
for the BurnWith command. That defined in the library allows you to
BURN, LIGHT, IGNITE or SET FIRE something WITH something. In the case of
the candle and the torch, however, it would be perfectly natural for the
player to type, for example, LIGHT CANDLE FROM TORCH. To allow this, we
can simply override the vocabulary defined in the library, leaving
everything else as it is:</p>

<p>modify VerbRule(BurnWith)<br />
     (‘light’ | ’burn’ | ’ignite’ | ’set’ ’fire’ ’to’) singleDobj<br />
         (‘with’ | ’from’) singleIobj<br />
     : <br />
;</p>

<p>Although we have already defined a RedCandle class, we need to tweak it
a bit. Firstly, once a candle is lit, there’s no reason why it shouldn’t
be used to light other candles (or anything else that’s ignitable), so
we should add FireSource to its class list. Secondly, a candle is not a
very efficient light source (we shall assume), so we’ll reduce its
brightnessOn to 2 (this may not make much practical difference here, but
one could devise situations in which it could be made to). Thirdly, a
Candle continues to burn until its <strong>fuelLevel</strong> reaches zero, its
fuelLevel being decremented by 1 each turn. By default a Candle starts
with a fuelLevel of 20, but we’ll be less generous with our Candles,
making them a temporary expedient until the player finds a more
efficient light source. Finally, once a candle has burned down, there’s
nothing left but a stub, and this should be reflected in its
description. It’s this last requirement that will add most of the
complication.</p>

<p>class RedCandle : <strong>FireSource,</strong> Dispensable, Candle ’red candle*candles’ ’red candle’<br />
  <strong>desc()<br />
  {<br />
    switch(fuelLevel)<br />
    {<br />
     case 0:<br />
      ”It’s just the stub of a red candle. ”; break;<br />
     case 1: <br />
      ”There’s not much of it left. ”; break;<br />
     case 2:<br />
      ”It’s little more than a stub. ”; break;     <br />
     case 3:<br />
      ”It’s a short red candle. ”; break;<br />
     case 4:<br />
      ”It’s reasonably long. ”; break;<br />
     default:<br />
      ”It’s a long red candle. ”;         <br />
    }<br />
    if(isLit)<br />
    {<br />
      ”It’s alight”;<br />
      if(fuelLevel &lt; 3)<br />
        ”, but its flame is starting to flicker”; <br />
      ”. ”;  <br />
    }<br />
  }</strong><br />
  isEquivalent = true<br />
  isListedInContents = (!isIn(myDispenser))<br />
  myDispenser = candleBox<br />
  **fuelLevel = 7<br />
  brightnessOn = 2<br />
  sayBurnedOut()<br />
  {<br />
    inherited;<br />
    local cur = new RedCandleStub;<br />
    cur.moveInto(location);<br />
    moveInto(nil);    <br />
  }</p>

<p>  dobjFor(BurnWith)<br />
  {<br />
    check()<br />
    {<br />
      if(fuelLevel &lt; 1)<br />
        sayBurnedOut;<br />
      else<br />
        inherited;<br />
    }<br />
  }</p>

<p>**;</p>

<p>class RedCandleStub: Thing ’red candle stub*stubs*candles’ ’red candle stub’<br />
  ”It’s just the stub of a red candle. ”<br />
  isEquivalent = true<br />
  weight = 0<br />
  bulk = 0<br />
;</p>

<p>The desc() method provides a suitable description of the candle at
various fuel levels, adding a suitable second sentence if it’s lit. When
the candle runs out of fuel its <strong>sayBurnedOut()</strong> method is called,
which makes this a good place to add any other special handling for this
eventuality. What we want here is for the original candle to be replaced
by a worthless candlestub object, so we create a new RedCandleStub, move
it into the location of the candle that’s just burned down to nothing,
then move the burned-out candle to nil to dispose of it. We can’t just
tinker with the name and vocabWords properties of the burned out candle
object, since the <strong>isEquivalent</strong> property being set to true means that
all members of the RedCandle class must be effectively identical. The
checkDobjBurnWith() handles the case when the player douses the candle
just before it goes out and then tries to light it again; the standard
library behaviour would prevent the candle being lit, and so it would
never be replaced with a stub.</p>


</main>
<footer id="footer">
    <p>This is an unofficial informational website to aggregate TADS 3 information and does not claim authorship over, or any rights to, TADS 3 itself. All resources copyright their credited owners. TADS itself is <a href="https://www.tads.org/copyright.htm">Copyright ©2001-2013 Michael J. Roberts</a>.</p>
    <p><a href="/">Back to Homepage</a></p>
</footer>
</body>
</html>

<script>
    if(window.location !== window.top.location) {
        let header = document.getElementById('header');
        let footer = document.getElementById('footer');
        header.remove();
        footer.remove();
    }
</script>