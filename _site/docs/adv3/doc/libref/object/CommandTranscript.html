<p><span class="title">CommandTranscript</span><span class="type">class</span></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#606">606</a>]</p>

<p><a href="#_SuperClassTree_">Superclass<br />
Tree</a></p>

<p><a href="#_SubClassTree_">Subclass<br />
Tree</a></p>

<p><a href="#_ObjectSummary_">Global<br />
Objects</a></p>

<p><a href="#_PropSummary_">Property<br />
Summary</a></p>

<p><a href="#_MethodSummary_">Method<br />
Summary</a></p>

<p><a href="#_Properties_">Property<br />
Details</a></p>

<p><a href="#_Methods_">Method<br />
Details</a></p>

<div class="fdesc">

Command Transcript. This is a "semantic transcript" of the results of a
command. This provides a list of CommandReport objects describing the
results of the command.

`class `**`CommandTranscript`**` :   `[`OutputFilter`](../object/OutputFilter.html)

</div>

<p><span id="_SuperClassTree_"></span></p>

<div class="mjhd">

<span class="hdln">Superclass Tree</span>   (in declaration order)

</div>

<p><strong><code class="language-plaintext highlighter-rouge">CommandTranscript</code></strong><br />
`         <code class="language-plaintext highlighter-rouge">[</code>OutputFilter<code class="language-plaintext highlighter-rouge">](../object/OutputFilter.html)  
</code>                 object`<br />
<span id="_SubClassTree_"></span></p>

<div class="mjhd">

<span class="hdln">Subclass Tree</span>  

</div>

<p><em>(none)</em> <span id="_ObjectSummary_"></span></p>

<div class="mjhd">

<span class="hdln">Global Objects</span>  

</div>

<p><em>(none)</em> <span id="_PropSummary_"></span></p>

<div class="mjhd">

<span class="hdln">Summary of Properties</span>  

</div>

<p>` <code class="language-plaintext highlighter-rouge">[</code>isActive<code class="language-plaintext highlighter-rouge">](#isActive)</code>  <code class="language-plaintext highlighter-rouge">[</code>isFailure<code class="language-plaintext highlighter-rouge">](#isFailure)</code>  <code class="language-plaintext highlighter-rouge">[</code>iter_<code class="language-plaintext highlighter-rouge">](#iter_)</code>  <code class="language-plaintext highlighter-rouge">[</code>reports_<code class="language-plaintext highlighter-rouge">](#reports_)</code>  <code class="language-plaintext highlighter-rouge">[</code>transforms_<code class="language-plaintext highlighter-rouge">](#transforms_)</code>  `</p>

<p>` `</p>

<p><span id="_MethodSummary_"></span></p>

<div class="mjhd">

<span class="hdln">Summary of Methods</span>  

</div>

<p>` <code class="language-plaintext highlighter-rouge">[</code>actionFailed<code class="language-plaintext highlighter-rouge">](#actionFailed)</code>  <code class="language-plaintext highlighter-rouge">[</code>activate<code class="language-plaintext highlighter-rouge">](#activate)</code>  <code class="language-plaintext highlighter-rouge">[</code>addCommandSep<code class="language-plaintext highlighter-rouge">](#addCommandSep)</code>  <code class="language-plaintext highlighter-rouge">[</code>addMarker<code class="language-plaintext highlighter-rouge">](#addMarker)</code>  <code class="language-plaintext highlighter-rouge">[</code>addReport<code class="language-plaintext highlighter-rouge">](#addReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>announceAmbigActionObject<code class="language-plaintext highlighter-rouge">](#announceAmbigActionObject)</code>  <code class="language-plaintext highlighter-rouge">[</code>announceDefaultObject<code class="language-plaintext highlighter-rouge">](#announceDefaultObject)</code>  <code class="language-plaintext highlighter-rouge">[</code>announceImplicit<code class="language-plaintext highlighter-rouge">](#announceImplicit)</code>  <code class="language-plaintext highlighter-rouge">[</code>announceMultiActionObject<code class="language-plaintext highlighter-rouge">](#announceMultiActionObject)</code>  <code class="language-plaintext highlighter-rouge">[</code>announceRemappedAction<code class="language-plaintext highlighter-rouge">](#announceRemappedAction)</code>  <code class="language-plaintext highlighter-rouge">[</code>applyTransforms<code class="language-plaintext highlighter-rouge">](#applyTransforms)</code>  <code class="language-plaintext highlighter-rouge">[</code>canShowReport<code class="language-plaintext highlighter-rouge">](#canShowReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>clearReports<code class="language-plaintext highlighter-rouge">](#clearReports)</code>  <code class="language-plaintext highlighter-rouge">[</code>construct<code class="language-plaintext highlighter-rouge">](#construct)</code>  <code class="language-plaintext highlighter-rouge">[</code>currentActionHasReport<code class="language-plaintext highlighter-rouge">](#currentActionHasReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>deactivate<code class="language-plaintext highlighter-rouge">](#deactivate)</code>  <code class="language-plaintext highlighter-rouge">[</code>deleteLastReport<code class="language-plaintext highlighter-rouge">](#deleteLastReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>deleteRange<code class="language-plaintext highlighter-rouge">](#deleteRange)</code>  <code class="language-plaintext highlighter-rouge">[</code>endDescription<code class="language-plaintext highlighter-rouge">](#endDescription)</code>  <code class="language-plaintext highlighter-rouge">[</code>filterText<code class="language-plaintext highlighter-rouge">](#filterText)</code>  <code class="language-plaintext highlighter-rouge">[</code>findCurrentActionReport<code class="language-plaintext highlighter-rouge">](#findCurrentActionReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>flushForInput<code class="language-plaintext highlighter-rouge">](#flushForInput)</code>  <code class="language-plaintext highlighter-rouge">[</code>forEachReport<code class="language-plaintext highlighter-rouge">](#forEachReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>getLastReport<code class="language-plaintext highlighter-rouge">](#getLastReport)</code>  <code class="language-plaintext highlighter-rouge">[</code>moveRangeAppend<code class="language-plaintext highlighter-rouge">](#moveRangeAppend)</code>  <code class="language-plaintext highlighter-rouge">[</code>newIter<code class="language-plaintext highlighter-rouge">](#newIter)</code>  <code class="language-plaintext highlighter-rouge">[</code>noteFailure<code class="language-plaintext highlighter-rouge">](#noteFailure)</code>  <code class="language-plaintext highlighter-rouge">[</code>showReports<code class="language-plaintext highlighter-rouge">](#showReports)</code>  <code class="language-plaintext highlighter-rouge">[</code>summarizeAction<code class="language-plaintext highlighter-rouge">](#summarizeAction)</code>  `</p>

<p>` `</p>

<p><span id="_Properties_"></span></p>

<div class="mjhd">

<span class="hdln">Properties</span>  

</div>

<p><span id="isActive"></span></p>

<p><code class="language-plaintext highlighter-rouge">isActive</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#648">648</a>]</p>

<div class="desc">

flag: I'm active; when this is nil, we'll pass text through our filter
routine unchanged

</div>

<p><span id="isFailure"></span></p>

<p><code class="language-plaintext highlighter-rouge">isFailure</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#617">617</a>]</p>

<div class="desc">

flag: the command has failed (i.e., at least one failure report has been
generated)

</div>

<p><span id="iter_"></span></p>

<p><code class="language-plaintext highlighter-rouge">iter_</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1235">1235</a>]</p>

<div class="desc">

iteration number - for an iterated top-level command, this helps us keep
the results for a particular iteration grouped together

</div>

<p><span id="reports_"></span></p>

<p><code class="language-plaintext highlighter-rouge">reports_</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1238">1238</a>]</p>

<div class="desc">

our vector of reports

</div>

<p><span id="transforms_"></span></p>

<p><code class="language-plaintext highlighter-rouge">transforms_</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1241">1241</a>]</p>

<div class="desc">

our list of transformations

</div>

<p><span id="_Methods_"></span></p>

<div class="mjhd">

<span class="hdln">Methods</span>  

</div>

<p><span id="actionFailed"></span></p>

<p><code class="language-plaintext highlighter-rouge">actionFailed (action)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#634">634</a>]</p>

<div class="desc">

Did the given action fail? This scans the transcript to determine if
there are any failure messages associated with the given action.

</div>

<p><span id="activate"></span></p>

<p><code class="language-plaintext highlighter-rouge">activate ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#842">842</a>]</p>

<div class="desc">

activate - set up to capture output

</div>

<p><span id="addCommandSep"></span></p>

<p><code class="language-plaintext highlighter-rouge">addCommandSep ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1148">1148</a>]</p>

<div class="desc">

Add a command separator.

</div>

<p><span id="addMarker"></span></p>

<p><code class="language-plaintext highlighter-rouge">addMarker ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1005">1005</a>]</p>

<div class="desc">

Add a marker report. This adds a marker to the report stream, and
returns the marker object. The marker doesn't show any message in the
final display, but callers can use a pair of markers to identify a range
of reports for later reordering or removal.

</div>

<p><span id="addReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">addReport (report)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#934">934</a>]</p>

<div class="desc">

Add a report.

</div>

<p><span id="announceAmbigActionObject"></span></p>

<p><code class="language-plaintext highlighter-rouge">announceAmbigActionObject (obj, whichObj)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1129">1129</a>]</p>

<div class="desc">

Announce an object that was resolved with slight ambiguity.

</div>

<p><span id="announceDefaultObject"></span></p>

<p><code class="language-plaintext highlighter-rouge">announceDefaultObject (obj, whichObj, action, allResolved)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1138">1138</a>]</p>

<div class="desc">

Announce a default object.

</div>

<p><span id="announceImplicit"></span></p>

<p><code class="language-plaintext highlighter-rouge">announceImplicit (action, msgProp)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1080">1080</a>]</p>

<div class="desc">

Announce that the action is implicit

</div>

<p><span id="announceMultiActionObject"></span></p>

<p><code class="language-plaintext highlighter-rouge">announceMultiActionObject (preCalcMsg, obj, whichObj)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1119">1119</a>]</p>

<div class="desc">

Announce one of a set of objects to a multi-object action. We'll record
this announcement for display with our report list.

</div>

<p><span id="announceRemappedAction"></span></p>

<p><code class="language-plaintext highlighter-rouge">announceRemappedAction ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1109">1109</a>]</p>

<div class="desc">

Announce a remapped action

</div>

<p><span id="applyTransforms"></span></p>

<p><code class="language-plaintext highlighter-rouge">applyTransforms ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1203">1203</a>]</p>

<div class="desc">

apply transformations

</div>

<p><span id="canShowReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">canShowReport (report)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1169">1169</a>]</p>

<div class="desc">

Can we show a given report? By default, we always return true, but
subclasses might want to override this to suppress certain types of
reports.

</div>

<p><span id="clearReports"></span></p>

<p><code class="language-plaintext highlighter-rouge">clearReports ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1157">1157</a>]</p>

<div class="desc">

clear our reports

</div>

<p><span id="construct"></span></p>

<p><code class="language-plaintext highlighter-rouge">construct ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#607">607</a>]</p>

<div class="desc">

*no description available*

</div>

<p><span id="currentActionHasReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">currentActionHasReport (func)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1214">1214</a>]</p>

<div class="desc">

check to see if the current action has a report matching the given
criteria

</div>

<p><span id="deactivate"></span></p>

<p><code class="language-plaintext highlighter-rouge">deactivate ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#849">849</a>]</p>

<div class="desc">

deactivate - stop capturing output

</div>

<p><span id="deleteLastReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">deleteLastReport ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#991">991</a>]</p>

<div class="desc">

delete the last report added

</div>

<p><span id="deleteRange"></span></p>

<p><code class="language-plaintext highlighter-rouge">deleteRange (marker1, marker2)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1018">1018</a>]</p>

<div class="desc">

delete the reports between two markers

</div>

<p><span id="endDescription"></span></p>

<p><code class="language-plaintext highlighter-rouge">endDescription ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1071">1071</a>]</p>

<div class="desc">

End the description section of the report. This adds a marker report
that indicates that anything following (and part of the same action) is
no longer part of the description; this can be important when we apply
the default description suppression transformation, because it tells us
not to consider the non-descriptive messages following this marker when,
for example, suppressing default descriptive messages.

</div>

<p><span id="filterText"></span></p>

<p><code class="language-plaintext highlighter-rouge">filterText (ostr, txt)</code><span class="rem">OVERRIDDEN</span></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1177">1177</a>]</p>

<div class="desc">

Filter text. If we're active, we'll turn the text into a command report
and add it to our report list, blocking the text from reaching the
underlying stream; otherwise, we'll pass it through unchanged.

</div>

<p><span id="findCurrentActionReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">findCurrentActionReport (func)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1221">1221</a>]</p>

<div class="desc">

find a report in the current action that matches the given criteria

</div>

<p><span id="flushForInput"></span></p>

<p><code class="language-plaintext highlighter-rouge">flushForInput ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#871">871</a>]</p>

<div class="desc">

Flush the transcript in preparation for reading input. This shows all
pending reports, clears the backlog of reports (so that we don't show
them again in the future), and deactivates the transcript's capture
feature so that subsequent output goes directly to the output stream.

We return the former activation status - that is, we return true if the
transcript was activated before the call, nil if not.

</div>

<p><span id="forEachReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">forEachReport (func)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1060">1060</a>]</p>

<div class="desc">

Perform a callback on all of the reports in the transcript. We'll invoke
the given callback function func(rpt) once for each report, with the
report object as the parameter.

</div>

<p><span id="getLastReport"></span></p>

<p><code class="language-plaintext highlighter-rouge">getLastReport ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#984">984</a>]</p>

<div class="desc">

get the last report added

</div>

<p><span id="moveRangeAppend"></span></p>

<p><code class="language-plaintext highlighter-rouge">moveRangeAppend (marker1, marker2)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#1035">1035</a>]</p>

<div class="desc">

Pull out the reports between two markers, and reinsert them at the end
of the transcript.

</div>

<p><span id="newIter"></span></p>

<p><code class="language-plaintext highlighter-rouge">newIter ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#859">859</a>]</p>

<div class="desc">

Count an iteration. An Action should call this once per iteration if
it's a top-level (non-nested) command.

</div>

<p><span id="noteFailure"></span></p>

<p><code class="language-plaintext highlighter-rouge">noteFailure ( )</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#623">623</a>]</p>

<div class="desc">

Note that the current action has failed. This is equivalent to adding a
reportFailure() message to the transcript.

</div>

<p><span id="showReports"></span></p>

<p><code class="language-plaintext highlighter-rouge">showReports (deact)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#887">887</a>]</p>

<div class="desc">

Show our reports. Returns true if the transcript was previously active,
nil if not.

</div>

<p><span id="summarizeAction"></span></p>

<p><code class="language-plaintext highlighter-rouge">summarizeAction (cond, report)</code></p>

<p><a href="../file/report.t.html">report.t</a>[<a href="../source/report.t.html#693">693</a>]</p>

<div class="desc">

Summarize the current action's reports. This allows a caller to turn a
series of iterated reports into a single report for the entire action.
For example, we could change something like this:

gold coin: Bob accepts the gold coin.  
gold coin: Bob accepts the gold coin.  
gold coin: Bob accepts the gold coin.

into this:

Bob accepts the three gold coins.

This function runs through the reports for the current action,
submitting each one to the 'cond' callback to see if it's of interest to
the summary. For each consecutive run of two or more reports that can be
summarized, we'll remove the reports that 'cond' accepted, and we'll
remove the multiple-object announcement reports associated with them,
and we'll insert a new report with the message returned by the 'report'
callback.

'cond' is called as cond(x), where 'x' is a report object. This callback
returns true if the report can be summarized for the caller's purposes,
nil if not.

'report' is called as report(vec), where 'vec' is a Vector consisting of
all of the consecutive report objects that we're now summarizing. This
function returns a string giving the message to use in place of the
reports we're removing. This should be a summary message, standing in
for the set of individual reports we're removing.

There's an important subtlety to note. If the messages you're
summarizing are conversational (that is, if they're generated by
TopicEntry responses), you should take care to generate the full
replacement text in the 'report' part, rather than doing so in separate
code that you run after summarizeAction() returns. This is important
because it ensures that the Conversation Manager knows that your
replacement message is part of the same conversation. If you wait until
after summarizeAction() returns to generate more response text, the
conversation manager won't realize that the additional text is part of
the same conversation.

</div>

<div class="ftr">

TADS 3 Library Manual  
Generated on 5/16/2013 from TADS version 3.1.3

</div>
